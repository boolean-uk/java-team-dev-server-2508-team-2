FROM mcr.microsoft.com/openjdk/jdk:21-ubuntu AS build

RUN apt-get update && apt-get install git -y

ARG BRANCH=main

RUN git clone --branch $BRANCH https://github.com/boolean-uk/java-team-dev-server-2508-team-2
WORKDIR java-team-dev-server-2508-team-2

RUN chmod +x gradlew
RUN ./gradlew build

FROM mcr.microsoft.com/openjdk/jdk:21-ubuntu
COPY --from=build java-team-dev-server-2508-team-2/build/libs/ .


EXPOSE 4000

ENTRYPOINT [ "java", "-jar", "server.jar" ]
